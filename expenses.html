<!doctype html>
<html>

<head>
    <title>Ausgaben</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html {
            font-family: sans-serif;
        }

        thead {
            font-weight: bold;
        }

        h1 {
            display: inline;
        }

        label {
            font-size: 70%;
        }

        .align-right {
            text-align: right;
        }

        .container {
            display: flex;
            flex-direction: row;
        }

        .float-right {
            float: right;
        }

        .modal {
            color: gray;
        }

        .display-none {
            display: none;
        }

        .error {
            border-color: red;
        }

        .va-bottom {
            vertical-align: bottom;
        }

        tr>td .visible-on-tr-hover {
            visibility: hidden;
        }

        tr.modal:hover>td .visible-on-tr-hover {
            visibility: hidden;
        }

        tr:hover>td .visible-on-tr-hover {
            visibility: visible;
        }
    </style>
    <script src="lib/uuidv4.min.js"></script>
    <script>
        "use strict";

        const state = {
            saved: true,
            edit: null,
            month: null,
            day: null,
            filename: null,
            data: {
                version: 2,
                expenses: []
            }
        }

        const dayHeadingFormat = new Intl.DateTimeFormat([], { weekday: 'long', day: '2-digit', month: '2-digit' });
        const dayFormat = new Intl.DateTimeFormat([], { day: '2-digit', month: '2-digit' });
        const monthFormat = new Intl.DateTimeFormat([], { month: 'long', year: 'numeric' });
        const decimalRegex = /^([0-9]+\.?[0-9]*|\.[0-9]+)$/;
        const integerRegex = /^([0-9]+)$/;

        const today = dateToYmd(new Date(Date.now()));

        class ExpensesError {
            constructor(message, origins) {
                this.message = message;
                this.origins = origins;
            }
        }

        class Expense {
            constructor(dateString, amount, currency, exchangeRate, description, recurrencePeriodicity, recurrenceFrequency, recurrenceFromString, recurrenceToString) {
                if (arguments.length !== 1) {
                    // create new
                    this.id = uuidv4();
                    this.date = dateString ? new Date(dateString) : null;
                    this.amount = amount;
                    this.currency = currency;
                    this.exchangeRate = exchangeRate;
                    this.description = description;
                    this.createDate = new Date(Date.now());
                    if (recurrencePeriodicity) {
                        this.recurrence = {
                            periodicity: recurrencePeriodicity,
                            frequency: parseInt(recurrenceFrequency),
                            from: new Date(recurrenceFromString),
                            to: recurrenceToString ? new Date(recurrenceToString) : null
                        }
                    }
                }
                else {
                    // create from json
                    const obj = arguments[0];
                    this.id = obj.id;
                    this.date = obj.date ? new Date(obj.date) : null;
                    this.amount = obj.amount;
                    this.currency = obj.currency;
                    this.exchangeRate = obj.exchangeRate;
                    this.description = obj.description;
                    this.createDate = new Date(obj.createDate);
                    if (obj.recurrence) {
                        this.recurrence = {
                            periodicity: obj.recurrence.periodicity,
                            frequency: parseInt(obj.recurrence.frequency),
                            from: new Date(obj.recurrence.from),
                            to: obj.recurrence.to ? new Date(obj.recurrence.to) : null
                        }
                    }
                }
            }

            getAmountChf() {
                if (isDefaultCurrency(this.currency)) {
                    return parseFloat(this.amount);
                }
                return parseFloat(this.exchangeRate) * parseFloat(this.amount);
            }

            getMonthlyAmount() {
                if (this.recurrence.periodicity === 'yearly') {
                    return this.amount / this.recurrence.frequency / 12;
                }
                if (this.recurrence.periodicity === 'monthly') {
                    return this.amount / this.recurrence.frequency;
                }
                throw 'Inconsistent recurring expense';
            }

            isValid(date) {
                const firstDayOfNextMonth = getFirstDayOfNextMonth(date);
                const firstDayOfCurrentMonth = new Date(date.getFullYear(), date.getMonth(), 1);
                return this.recurrence.from < firstDayOfNextMonth && (!this.recurrence.to || this.recurrence.to >= firstDayOfCurrentMonth)
            }
        }

        window.onerror = (msg, url, lineNo, columnNo, error) => {
            if (error instanceof ExpensesError) {
                error.origins.forEach(o => o.classList.add('error'))
                alert(error.message);
                return;
            }
            throw error;
        };

        window.addEventListener('beforeunload', e => {
            if (!state.saved) {
                e.preventDefault();
                e.returnValue = 'Ungespeicherte Änderungen vorhanden';
            }
        });

        document.onkeydown = e => {
            if (e.key === 'Enter') {
                if (['description', 'amount', 'currency-input', 'date-input', 'exchange-rate', 'recurring-checkbox', 'recurring-frequency', 'recurring-monthly', 'recurring-yearly', 'recurring-from', 'recurring-to', 'recurr'].includes(e.target.id)) {
                    if (e.ctrlKey) {
                        submitForm();
                    }
                    // disable Enter-only for submitting
                    return false;
                }
            }
            if (e.ctrlKey) {
                if (e.key === 'o') {
                    openFile();
                    return false;
                }
                if (e.key === 's') {
                    save();
                    return false;
                }
            }
            return true;
        };

        /*
         * DateUtility
         */
        function getMonth(ymd) {
            return ymd.substring(0, 7);
        }

        function dateToYmd(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, 0)}`;
        }

        function isSameDay(d1, d2) {
            return d1.getDate() === d2.getDate()
                && d1.getMonth() === d2.getMonth()
                && d1.getFullYear() === d2.getFullYear();
        }

        function getFirstDayOfNextMonth(date) {
            if (date.getMonth() == 11) {
                return new Date(date.getFullYear() + 1, 0, 1);
            }
            return new Date(date.getFullYear(), date.getMonth() + 1, 1);
        }

        /*
         * Data store
         */
        function getExpenses() {
            return state.data.expenses;
        }

        function setExpenses(newExpenses) {
            state.data.expenses = newExpenses;
        }

        function getCurrentDayString() {
            return state.month + '-' + state.day;
        }

        function getOnetimeExpenses() {
            return getExpenses()
                .filter(e => !e.recurrence);
        }

        function getDaysOfMonth(month) {
            let days = {};
            let monthNumeric = parseInt(month.substring(5, 7)) - 1;
            let date = new Date(month);
            let dateOfToday = new Date(Date.now());
            while (date.getMonth() === monthNumeric) {
                let day = {
                    description: []
                };
                getOnetimeExpenses()
                    .filter(e => isSameDay(date, e.date))
                    .forEach(e => {
                        day.amount = (day.amount || 0) + e.getAmountChf();
                        const firstHashPosition = e.description.indexOf('#');
                        const dealer = e.description.substr(0, firstHashPosition === -1 ? undefined : firstHashPosition).trim();
                        if (!day.description.includes(dealer)) {
                            day.description.push(dealer);
                        }
                    });
                days[dateToYmd(date)] = day;
                date.setDate(date.getDate() + 1);
            }
            return days;
        }

        function getExpensesOfDay(day) {
            return getOnetimeExpenses()
                .filter(e => dateToYmd(e.date).substring(0, 10) === day);
        }

        /*
         * UI
         */
        function getAmountInput() {
            return document.getElementById('amount');
        }

        function getComputedChfValue() {
            return document.getElementById('computed-chf-value');
        }

        function getCurrencySelect() {
            return document.getElementById('currency-input');
        }

        function getDateInput() {
            return document.getElementById('date-input');
        }

        function getDateLabel() {
            return document.querySelector('label[for="date-input"]')
        }

        function getDayExpensesDiv() {
            return document.getElementById('day-expenses');
        }

        function getDescriptionInput() {
            return document.getElementById('description');
        }

        function getExchangeRateInput() {
            return document.getElementById('exchange-rate');
        }

        function getExpenseForm() {
            return document.getElementById('expense-form');
        }

        function getSaveButton() {
            return document.getElementById('save-button');
        }

        function getFileInput() {
            return document.getElementById('file-input');
        }

        function getMonthTable() {
            return document.getElementById('month-table');
        }

        function getMonthLabel() {
            return document.getElementById('month-label');
        }

        function getRecurringCheckbox() {
            return document.getElementById('recurring-checkbox');
        }

        function getRecurringExpenses() {
            return document.getElementById('recurring-expenses');
        }

        function getRecurringFrequency() {
            return document.getElementById('recurring-frequency');
        }

        function getRecurringFrom() {
            return document.getElementById('recurring-from');
        }

        function getRecurringMonthly() {
            return document.getElementById('recurring-monthly');
        }

        function getRecurringTo() {
            return document.getElementById('recurring-to');
        }

        function getRecurringYearly() {
            return document.getElementById('recurring-yearly');
        }

        function renderFloat(f) {
            return f.toFixed(2);
        }

        function renderDay(d) {
            return dayFormat.format(d);
        }

        function getEditExpense() {
            if (!state.edit) {
                return null;
            }
            const index = getExpenses().findIndex(e => e.id === state.edit);
            return state.data.expenses[index];
        }

        function renderAmountTd(content) {
            return `<td class="align-right">${content}</td>`;
        }

        function render() {
            let monthLabel = '';
            if (state.month) {
                monthLabel = monthFormat.format(new Date(state.month));
            }
            getMonthLabel().textContent = monthLabel;

            renderRecurringExpenses();
            renderMonthTable();

            let dayHeading = '';
            if (state.day) {
                dayHeading = `<h2>${dayHeadingFormat.format(new Date(getCurrentDayString()))}</h2>`;
            }
            let dayTable = renderDayTable();
            let form = renderForm();
            getDayExpensesDiv().innerHTML = dayHeading + dayTable + form;

            getSaveButton().disabled = state.saved;
            getDescriptionInput().focus();
            getExpenseForm().addEventListener('submit', submitForm);
        }

        function renderRecurringExpenses() {
            const currentDay = new Date(getCurrentDayString());

            const recurringExpenses = getExpenses()
                .filter(e => e.recurrence)
                .filter(e => e.isValid(currentDay));

            if (recurringExpenses.length === 0) {
                getRecurringExpenses().innerHTML = '';
                return;
            }

            let recurringExpensesHtml = `
                    <h2>Wiederkehrende Ausgaben</h2>
                    <table>`;
            recurringExpensesHtml += recurringExpenses
                .map(e => renderExpenseTr(`
                        <td>${e.description}</td>
                        ${renderAmountTd(renderFloat(e.getMonthlyAmount()))}
                        <td>${e.currency}</td>
                        ${renderModificationButtons(e)}`))
                .join('\n');

            recurringExpensesHtml += '</table>';
            getRecurringExpenses().innerHTML = recurringExpensesHtml;
        }

        function renderMonthTable() {
            let tableContent = `
            <thead>
            <tr>
                <td>Datum</td>
                ${renderAmountTd('Betrag')}
                <td></td>
                <td>Beschreibung</td>
            </tr>
                    </thead> `;
            tableContent += '<tbody>';
            Object.entries(getDaysOfMonth(state.month))
                .forEach(d => {
                    const [ymd, row] = d;
                    tableContent += `
            <tr>
                        <td><a href="#" onclick="setDay('${ymd.substring(8, 10)}');">${renderDay(new Date(ymd))}</a></td>
                        ${renderAmountTd(row.amount ? renderFloat(row.amount) : '')}
                        <td>${row.amount ? 'CHF' : ''}</td>
                        <td>${row.description.join(', ')}</td>
                    </tr>
            `;
                });
            tableContent += '</tbody>';
            getMonthTable().innerHTML = tableContent;
        }

        function renderForm() {
            const expense = getEditExpense();
            const currencies = ['CHF', '€'];
            let form = `
            <h2> ${!expense ? 'Neue ' : ''}Ausgabe${expense ? ' bearbeiten' : ''}</h2>
                <form id="expense-form" autocomplete="off">
                    <label for="description">Beschreibung</label>
                    <input id="description" value="${expense ? expense.description : ''}" />
                    <br />
                    <label for="amount">Betrag</label>
                    <input id="amount" class="align-right" oninput="handleAmountOrExchangeRateInput();" onchange="validateDecimalField(getAmountInput(), 2);" value="${expense ? expense.amount : ''}" required />
                    <label for="currency-input" class="display-none">Währung</label>
                    <select id="currency-input" onchange="handleCurrencyChanged()" required>
                        ${currencies.map(c => `<option value="${c}" ${c === expense?.currency ? 'selected' : ''}>${c}</option>`)}
                    </select>`;

            const defaultCurrency = expense ? isDefaultCurrency(expense.currency) : true;
            form += `
                    <div id="form-line2" ${defaultCurrency ? 'class="display-none"' : ''}>
                        <label for="exchange-rate">Wechselkurs</label>
                        <input class="align-right" id="exchange-rate" oninput="handleAmountOrExchangeRateInput();" onchange="validateDecimalField(getExchangeRateInput(), 5);" value="${expense ? expense.exchangeRate : 1}" />
                        <span id="computed-chf-value">${defaultCurrency ? '' : renderFloat(expense?.getAmountChf())}</span> CHF
                    </div>`;

            const recurrence = expense?.recurrence;
            form += `
                    <div>
                        <label for="date-input" ${recurrence ? 'class="display-none"' : ''}>Datum</label>
                        <input id="date-input" type="date" ${recurrence ? 'class="display-none"' : ''} value="${expense?.date ? dateToYmd(expense.date) : (expense ? '' : getCurrentDayString())}" />
                    </div>`;

            const periodicity = recurrence?.periodicity;
            form += `
                    <div>
                        <input id="recurring-checkbox" type="checkbox" onchange="handleRecurringCheckboxChanged();" ${recurrence ? 'checked' : ''} /><label for="recurring-checkbox">Wiederkehrend</label>
                        <br />
                        <input id="recurring-frequency" type="number" class="align-right" size="2" maxlength="2" value="${recurrence ? recurrence.frequency : '1'}" onchange="validateIntegerField(getRecurringFrequency());" ${recurrence ? '' : 'disabled'} />-
                        <input id="recurring-monthly" name="recurring-periodicity" type="radio" ${!recurrence || periodicity === 'monthly' ? 'checked' : ''} ${recurrence ? '' : 'disabled'} /><label for="recurring-monthly">Monatlich</label>
                        <input id="recurring-yearly" name="recurring-periodicity" type="radio" ${periodicity === 'yearly' ? 'checked' : ''} ${recurrence ? '' : 'disabled'} /><label for="recurring-yearly">Jährlich</label>
                    </div>
                    <div id="recurring-fromto">
                        <label for="recurring-from">Start</label><label>/</label><label for="recurring-to">Ende</label>
                        <input id="recurring-from" type="date" value="${recurrence ? dateToYmd(recurrence.from) : ''}" ${recurrence ? '' : 'disabled'} />
                        <input id="recurring-to" type="date" value="${recurrence?.to ? dateToYmd(recurrence.to) : ''}" ${recurrence ? '' : 'disabled'} />
                    </div>
                    <div class="align-right">
                    <button type ="submit" title="${expense ? 'Speichern' : 'Hinzufügen'}">${expense ? '✅' : '➕'}</button>
                    ${expense ? `<button type="button" title="Abbrechen" onclick="cancelLineEdit();">❌</button>` : ''}
                </form>`;

            return form;
        }

        function getLastExchangeRate(currency, date) {
            const expensesOfDay = getExpenses()
                .filter(e => e.currency && isSameDay(e.date, date));
            let relevantExpenses = expensesOfDay;

            if (expensesOfDay.length === 0) {
                const expensesOfCurrency = getExpenses()
                    .filter(e => e.currency === getCurrencySelect().value);

                if (expensesOfCurrency.length === 0) {
                    return null;
                }
                relevantExpenses = expensesOfCurrency;
            }

            return relevantExpenses
                .reduce((latest, e) => e.createDate > latest.createDate ? e : latest)
                .exchangeRate;
        }

        function handleCurrencyChanged() {
            if (isDefaultCurrency(getCurrencySelect().value)) {
                document.getElementById('form-line2').classList.add('display-none');
                getExchangeRateInput().value = 1;
            }
            else {
                document.getElementById('form-line2').classList.remove('display-none');
                const latestExchangeRate = getLastExchangeRate(getCurrencySelect().value, new Date(getCurrentDayString()));
                if (latestExchangeRate) {
                    getExchangeRateInput().value = latestExchangeRate;
                }
            }
        }

        function handleRecurringCheckboxChanged() {
            [getRecurringFrequency(),
            getRecurringMonthly(),
            getRecurringYearly(),
            getRecurringFrom(),
            getRecurringTo()]
                .forEach(e => e.disabled = !getRecurringCheckbox().checked);

            if (getRecurringCheckbox().checked) {
                [getDateLabel(), getDateInput()]
                    .forEach(e => e.classList.add('display-none'));

                getRecurringFrom().value = getDateInput().value;
                getDateInput().value = null;
            }
            else {
                [getDateLabel(), getDateInput()]
                    .forEach(e => e.classList.remove('display-none'));

                getDateInput().value = getRecurringFrom().value;
                getRecurringFrom().value = null;
            }
        }

        function handleAmountOrExchangeRateInput() {
            if (isDefaultCurrency(getCurrencySelect().value)) {
                return;
            }
            const chfValue = parseFloat(getAmountInput().value) * parseFloat(getExchangeRateInput().value);
            getComputedChfValue().textContent = Number.isNaN(chfValue) ? '' : renderFloat(chfValue);
        }

        function isDefaultCurrency(currency) {
            return currency === 'CHF';
        }

        function renderModificationButtons(expense) {
            return `
                    <td> <button type="button" title="Bearbeiten" class="visible-on-tr-hover" onclick="startLineEdit('${expense.id}')">🖊</button></td>
                        <td><button type="button" title="Löschen" class="visible-on-tr-hover" onclick="removeExpense('${expense.id}');">🚮</button></td>`;
        }

        function renderExpenseTr(content) {
            return `<tr ${!state.edit ? '' : 'class="modal"'}> ${content}</tr> `;
        }

        function renderDayTable() {
            let dayExpenses = getExpensesOfDay(getCurrentDayString());
            let table = '<table>';
            if (dayExpenses.length > 0) {
                table += `
            <thead>
            <tr>
                <td>Beschreibung</td>
                ${renderAmountTd('Betrag')}
            </tr>
                    </thead> `;
            }
            table += '<tbody>';
            for (const expense of dayExpenses) {
                table += renderExpenseTr(`
                    <td>${expense.description}</td>
                    ${renderAmountTd(expense.amount)}
                    <td>${expense.currency}</td>
                    ${renderModificationButtons(expense)} `);
            }
            table += `
                    </tbody>
                </table> `;
            return table;
        }

        function validateDecimalField(decimalField, fractionalDigits) {
            validateField(decimalField, decimalRegex, () => {
                const components = decimalField.value.split('.');
                const integerPart = components[0] ? parseInt(components[0]) : '0';
                const fractionalPart = components[1] ? components[1].substring(0, fractionalDigits).padEnd(fractionalDigits, '0') : '00';
                return integerPart + '.' + fractionalPart;
            });
        }

        function validateIntegerField(integerField) {
            validateField(integerField, integerRegex, () => parseInt(integerField.value));
        }

        function validateField(field, regex, prettyPrinter) {
            field.value = field.value.trim();
            if (field.dataset.validatedValue === field.value) {
                return;
            }
            field.classList.remove('error');
            if (!field.value) {
                field.dataset.validatedValue = field.value;
                return;
            }
            if (!regex.test(field.value)) {
                field.dataset.validatedValue = field.value;
                throw new ExpensesError(`'${field.value}' ist keine gültige Zahl`, [field]);
            }
            const validatedValue = prettyPrinter();
            field.value = validatedValue;
            field.dataset.validatedValue = validatedValue;
        }

        function validateForm() {
            validateDecimalField(getAmountInput(), 2);
            validateDecimalField(getExchangeRateInput(), 5);
            validateIntegerField(getRecurringFrequency());

            const emptyFields = [];
            const mandatoryFields = [getAmountInput(), getExchangeRateInput(), getDescriptionInput()];
            if (getRecurringCheckbox().checked) {
                mandatoryFields.push(
                    getRecurringFrequency(),
                    getRecurringFrom());
            }
            else {
                mandatoryFields.push(getDateInput());
            }
            mandatoryFields.forEach(f => {
                f.classList.remove('error');
                if (!f.value) {
                    f.classList.add('error');
                    emptyFields.push(f);
                }
            });

            if (emptyFields.length > 0) {
                let fieldNames = emptyFields
                    .map(f => document.querySelector(`label[for="${f.id}"]`).textContent)
                    .join(' und ');
                throw new ExpensesError(`Bitte ${fieldNames} ausfüllen`, emptyFields);
            }
        }

        function removeExpense(id) {
            const index = getExpenses().findIndex(e => e.id === id);
            getExpenses().splice(index, 1);
            setSaved(false);
            render();
        }

        function startLineEdit(id) {
            state.edit = id;
            render();
        }

        function cancelLineEdit() {
            state.edit = null;
            render();
        }

        function getRecurrencePeriodicity() {
            if (!getRecurringCheckbox().checked) {
                return null;
            }
            if (getRecurringMonthly().checked) {
                return 'monthly';
            }
            if (getRecurringYearly().checked) {
                return 'yearly';
            }
        }

        function submitForm(event) {
            event?.preventDefault();

            validateForm();

            // FIXME eliminate this code duplication
            if (state.edit) {
                const entry = getEditExpense();
                entry.date = getDateInput().value ? new Date(getDateInput().value) : null;
                entry.amount = getAmountInput().value;
                entry.currency = getCurrencySelect().value;
                entry.exchangeRate = getExchangeRateInput().value;
                entry.description = getDescriptionInput().value.trim();
                if (getRecurringCheckbox().checked) {
                    entry.recurrence = entry.recurrence || {};
                    entry.recurrence.periodicity = getRecurrencePeriodicity();
                    entry.recurrence.frequency = parseInt(getRecurringFrequency().value);
                    entry.recurrence.from = new Date(getRecurringFrom().value);
                    entry.recurrence.to = getRecurringTo().value ? new Date(getRecurringTo().value) : null;
                }
                else {
                    entry.recurrence = undefined;
                }
                state.edit = null;
            }
            else {
                getExpenses().push(new Expense(
                    getDateInput().value,
                    getAmountInput().value,
                    getCurrencySelect().value,
                    getExchangeRateInput().value,
                    getDescriptionInput().value.trim(),
                    getRecurrencePeriodicity(),
                    getRecurringFrequency().value,
                    getRecurringFrom().value,
                    getRecurringTo().value));
            }

            setSaved(false);
            render();
        }

        function setDay(day) {
            if (state.day === day) {
                return;
            }
            state.day = day;
            render();
        }

        function openFile() {
            if (!state.saved && !confirm('Beim Öffnen werden ungespeicherte Änderungen überschrieben. Bist du sicher dass du eine Datei öffnen möchtest?')) {
                return;
            }
            getFileInput().click();
        }

        function save() {
            let jsonString = JSON.stringify(state.data, null, 2);
            let dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(jsonString);
            let a = document.createElement('a');
            a.rel = 'noopener';
            a.download = state.filename || 'ausgaben.json';
            a.target = '_blank';
            a.href = dataStr;
            a.dispatchEvent(new MouseEvent('click'));
            setSaved(true);
            render();
        }

        function setSaved(value) {
            if (getExpenses().length === 0) {
                state.saved = true;
                return;
            }
            state.saved = value;
            if (!state.saved) {
                getFileInput().value = '';
            }
        }

        function loadExpenses() {
            const file = getFileInput().files[0];
            if (!file) {
                return;
            }
            const reader = new FileReader();
            reader.onload = e => {
                const migratedData = migrate(JSON.parse(e.target.result));
                setExpenses(migratedData.expenses
                    .map(e => new Expense(e)));
                render();
                state.filename = file.name;
            }
            reader.readAsText(file);
        }

        function migrate(loadedData) {
            if (!loadedData.expenses[0].currency) {
                let createDate = Date.now() - (loadedData.expenses.length) * 100;
                loadedData.expenses.forEach(e => {
                    e.currency = 'CHF';
                    e.exchangeRate = '1';
                    e.createDate = new Date(createDate).toJSON();
                    createDate = createDate + 100;
                });
                loadedData.version = 2;
                state.saved = false;
                return loadedData;
            }
            return loadedData;
        }
    </script>
</head>

<body>
    <div class="bar">
        <h1 id="month-label">Ausgaben</h1>
        <span class="float-right">
            <button type="button" title="Öffnen" onclick="openFile();">📂</button>
            <input type="file" id="file-input" class="display-none" onchange="loadExpenses()" />
            <button type="button" id="save-button" title="Speichern" onclick="save();">💾</button>
        </span>
        <hr>
    </div>

    <div class="container">
        <div id="recurring-expenses"></div>
        <div>
            <h2>Ausgaben</h2>
            <table id="month-table"></table>
        </div>
        <div>
            <div id="day-expenses"></div>
        </div>
    </div>



    <script>
        "use strict";
        state.month = today.substring(0, 7);
        state.day = today.substring(8, 10);
        render();
    </script>
</body>

</html>
